<?php //echo '<pre>';print_r($_REQUEST);/*    [method] => list    [showdate] => 5/29/2014    [viewtype] => week    [timezone] => -5*/include_once("dbconfig.php");include_once("functions.php");function addCalendar($Datos){        include_once("../../../templates/template.php");		     $db = getBD();            $ret = array();        //echo '<pre>';print_r($Datos);die;     /*        [Sedes] => 4        [FechaIni] => 2014-07-01        [FechaFin] => 2014-07-31        [Userid] =>        [TipoSalon] => 01        [F_inicial] => 2014-07-01        [F_final] => 2014-07-01        [H_inicial] => 10:00 AM        [H_final] => 1:00 PM     */     $C_Hora_1 = explode(':',$Datos['H_inicial']);                    if($C_Hora_1[0]){              $Time = explode(' ',$C_Hora_1[1]);                        if($Time[1]=='AM'){                 $Fecha_1 = $Datos['F_inicial'].' '.$C_Hora_1[0].':'.$Time[0];            }else{                                if($C_Hora_1[0]==12){                                        $Fecha_1 = $Datos['F_inicial'].' '.$C_Hora_1[0].':'.$Time[0];                }else{                    $H_ini = $C_Hora_1[0]+12;                    $Fecha_1 = $Datos['F_inicial'].' '.$H_ini.':'.$Time[0];                   }//if                         }//if     }           $C_Hora_2 = explode(':',$Datos['H_final']);          if($C_Hora_2[0]){          $Time = explode(' ',$C_Hora_2[1]);        if($Time[1]=='AM'){             $Fecha_2 = $Datos['F_final'].' '.$C_Hora_2[0].':'.$Time[0];        }else{                        if($C_Hora_2[0]==12){                                $Fecha_2 = $Datos['F_final'].' '.$C_Hora_2[0].':'.$Time[0];            }else{                $H_ini = $C_Hora_2[0]+12;                $Fecha_2 = $Datos['F_final'].' '.$H_ini.':'.$Time[0];               }//if                   }//if          }       if(!$Datos['Userid']){        $ret['IsSuccess'] = false;        $ret['Msg'] = 'La seccion No Ha Iniciado';        $ret['Data'] =rand();        return $ret;    }else{                $Insert_temp='INSERT INTO  temp_solicitud(id_tiposalon,fecha_ini,fecha_fin,start,end,usuario,sede)VALUES("'.$Datos['TipoSalon'].'","'.$Fecha_1.'","'.$Fecha_2.'","'.$Datos['FechaIni'].'","'.$Datos['FechaFin'].'","'.$Datos['Userid'].'","'.$Datos['Sedes'].'")';                               if($TempDatos=&$db->Execute($Insert_temp)===false){            echo 'Error en el SQL <br><br>'.$Insert_temp;            die;        }           $ret['IsSuccess'] = true;      $ret['Msg'] = 'Se Ha Almacenado Correctamente.';      $ret['Data'] =rand();        return $ret;            }         }function addDetailedCalendar($st, $et, $sub, $ade, $dscr, $loc, $color, $tz){  $ret = array();      $ret['IsSuccess'] = true;      $ret['Msg'] = 'add success';      $ret['Data'] = rand();  return $ret;}function listCalendarByRange($sd, $ed, $cnt){   // echo '$sd->'.$sd.'<br>$ed->'.$ed.'<br>$cnt->'.$cnt;  $ret = array();  $ret['events'] = array();  $ret["issort"] =true;  $ret["start"] = php2JsTime($sd);  $ret["end"] = php2JsTime($ed);  $ret['error'] = null;  $title = array('team meeting', 'remote meeting', 'project plan review', 'annual report', 'go to dinner');  $location = array('Lodan', 'Newswer', 'Belion', 'Moore', 'Bytelin');  for($i=0; $i<$cnt; $i++) {      $rsd = rand($sd, $ed);      $red = rand(3600, 10800);      if(rand(0,10) > 8){          $alld = 1;      }else{          $alld=0;      }      $ret['events'][] = array(        rand(10000, 99999),        $title[rand(0,4)],        php2JsTime($rsd),        php2JsTime($red),        rand(0,1),//        $alld, //more than one day event--> Evento mas de un dia         0,//Recurring event -->evento Recurrente        rand(-1,13),//rand(-1,13)        1, //editable --> Editable        $location[rand(0,4)],         ''//$attends      );  }  //echo '<pre>';print_r($ret);  /*  Array(    [events] => Array        (            [0] => Array                (                    [0] => 51695            -->id                    [1] => annual report    -->Titulo                    [2] => 06/19/2014 02:06 -->Fecha Y hora de inicio                     [3] => 01/01/1970 01:43 -->Fecha y Hora final                    [4] => 0                -->Visulizar es mejor cero=0                    [5] => 0                -->Evento mas DE Un DIA = 0                    [6] => 0                -->Evento Concurrente                    [7] => 2                -->Color                    [8] => 1                -->Editable                     [9] => Belion           -->Localizacion                    [10] =>                 )                       )    [issort] => 1    [start] => 06/09/2014 00:00    [end] => 06/15/2014 23:59    [error] => )  */  return $ret;}function listCalendar($day, $type){  $phpTime = js2PhpTime($day);  //echo '<pre>';print_r($phpTime);  //echo $phpTime . "+" . $type;  switch($type){    case "month":      $st = mktime(0, 0, 0, date("m", $phpTime), 1, date("Y", $phpTime));      $et = mktime(0, 0, -1, date("m", $phpTime)+1, 1, date("Y", $phpTime));      $cnt = 50;      break;    case "week":      //suppose first day of a week is monday       $monday  =  date("d", $phpTime) - date('N', $phpTime) + 1;      //echo date('N', $phpTime);      $st = mktime(0,0,0,date("m", $phpTime), $monday, date("Y", $phpTime));      $et = mktime(0,0,-1,date("m", $phpTime), $monday+7, date("Y", $phpTime));      $cnt = 20;      break;    case "day":      $st = mktime(0, 0, 0, date("m", $phpTime), date("d", $phpTime), date("Y", $phpTime));      $et = mktime(0, 0, -1, date("m", $phpTime), date("d", $phpTime)+1, date("Y", $phpTime));      $cnt = 5;      break;  }  //echo $st . "--" . $et;  return listCalendarByRange($st, $et, $cnt);}function updateCalendar($id, $st, $et){  $ret = array();      $ret['IsSuccess'] = true;      $ret['Msg'] = 'Succefully';  return $ret;}function updateDetailedCalendar($id, $st, $et, $sub, $ade, $dscr, $loc, $color, $tz){  $ret = array();      $ret['IsSuccess'] = true;      $ret['Msg'] = 'Succefully';  return $ret;}function removeCalendar($id){    include_once("../../../templates/template.php");		     $db = getBD();         $Update='UPDATE temp_solicitud              SET    status="1"              WHERE  id_temp="'.$id.'" AND codigoestado=100';                         if($Modificar=&$db->Execute($Update)===false){            $ret['IsSuccess']			=false;            $ret['Msg']		='Error al Asignar el Tipo Salon...';            return $ret;          }                  $ret['IsSuccess'] = true;      $ret['Msg'] = 'Se ha Elininado la Solicitud.';  return $ret;}function AddTipoSalon($id,$TipoSalon,$Sede){       // var_dump(is_file('../../../templates/template.php'));die;         include_once("../../../templates/template.php");		     $db = getBD();         $Update='UPDATE temp_solicitud              SET    id_tiposalon="'.$TipoSalon.'",                     sede="'.$Sede.'"              WHERE  id_temp="'.$id.'" AND codigoestado=100';                         if($Modificar=&$db->Execute($Update)===false){            $ret['IsSuccess']			=false;            $ret['Msg']		='Error al Asignar el Tipo Salon...';            return $ret;          }                $ret['IsSuccess'] = true;      $ret['Msg'] = 'Se ha Asignado Correctamente el tipo de salon.';      return $ret;  }//AddTipoSalonheader('Content-type:text/javascript;charset=UTF-8');$method = $_REQUEST["method"];//echo '<pre>';print_r($_POST);die;/*$_GET    [method] => list    [FechaIni] => 2014-06-01    [FechaFin] => 2014-06-30    [Fre] => 36    [CadenaDia] => ,1    [HorasIni] => ,11:00 AM    [HorasFin] => ,7:00 PM*//*$_POST    [method] => list    [showdate] => 5/29/2014    [viewtype] => week    [timezone] => -5*/switch ($method) {    case "add":        $ret = addCalendar($_POST);                break;    case "ViewList":        include_once('../../../Solicitud/SolicitudEspacio_class.php');  $C_SolicitudEspacio = new SolicitudEspacio();                 $ret = $C_SolicitudEspacio->ViewFechas();                 break;        case "list":        //$ret = $_GET['Result'];        //var_dump(is_file('../../../Solicitud/SolicitudEspacio_html.php'));die;                include_once('../../../Solicitud/SolicitudEspacio_class.php');  $C_SolicitudEspacio = new SolicitudEspacio();                        $ret = $C_SolicitudEspacio->CalcularFechas($_REQUEST);            /* $Prueba['events'][0][]=2;        $Prueba['events'][0][]='prueba';        $Prueba['events'][0][]='06/16/2014 9:00';        $Prueba['events'][0][]='01/01/1970 15:00';        $Prueba['events'][0][]  = 0;                      $Prueba['events'][0][]  = 0;                       $Prueba['events'][0][]  = 0 ;                       $Prueba['events'][0][]  = rand(-1,13);              $Prueba['events'][0][]  = 1;                       $Prueba['events'][0][]  = 'Localizacion';                  $Prueba['events'][0][] = '';        $Prueba['issort'] = true;        $Prueba['start']  = '02/06/2014 00:00';        $Prueba['end']    = '04/07/2014 23:59';        $Prueba['error']  = null;*/                //$ret = $Prueba;        //$ret = listCalendar($_POST["showdate"], $_POST["viewtype"]);        /*                   /Fecha           , Semana o dia, Mes */        /*        [events] => Array        (            [0] => Array                (                    [0] => 82355                    [1] => remote meeting                    [2] => 06/16/2014 01:59                    [3] => 01/01/1970 02:26                    [4] => 1                    [5] => 0                    [6] => 0                    [7] => 7                    [8] => 1                    [9] => Lodan                    [10] =>                 )        [issort] => 1        [start] => 06/16/2014 00:00        [end] => 06/22/2014 23:59        [error] =>               */        //echo '<pre>';print_r($ret);die;        break;    case "xxxx":          $ret = listCalendar($_POST["showdate"], $_POST["viewtype"]);        break;      case "update":         //$ret = updateCalendar($_POST["calendarId"], $_POST["CalendarStartTime"], $_POST["CalendarEndTime"]);        break;     case "remove"://Elininar        //echo '<pre>';print_r($_POST);die;$_POST["calendarId"]->id        $ret = removeCalendar( $_POST["Temp_id"]);        break;    case "adddetails":        //$id = $_GET["id"];//        $st = $_POST["stpartdate"] . " " . $_POST["stparttime"];//        $et = $_POST["etpartdate"] . " " . $_POST["etparttime"];//        if($id){//            $ret = updateDetailedCalendar($id, $st, $et, //                $_POST["Subject"], $_POST["IsAllDayEvent"]?1:0, $_POST["Description"], //                $_POST["Location"], $_POST["colorvalue"], $_POST["timezone"]);//        }else{//            $ret = addDetailedCalendar($st, $et,                    //                $_POST["Subject"], $_POST["IsAllDayEvent"]?1:0, $_POST["Description"], //                $_POST["Location"], $_POST["colorvalue"], $_POST["timezone"]);//        }             $ret = AddTipoSalon($_POST['Temp_id'],$_POST['TipoSalon'],$_POST['Sedes']);              break; }//echo'<pre>';print_r($ret);echo json_encode($ret); ?>